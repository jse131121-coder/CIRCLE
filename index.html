<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>CIRCLE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system,sans-serif}
body{margin:0;background:#f4f6f8}
header{background:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #e6e6e6;position:sticky;top:0;z-index:10}
.logo{font-weight:900;letter-spacing:1px}
.btn{border:none;border-radius:18px;padding:7px 14px;cursor:pointer;font-size:13px}
.primary{background:#111;color:#fff}
.container{max-width:720px;margin:auto;padding:12px}
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;box-shadow:0 4px 10px rgba(0,0,0,.04)}
.flex{display:flex;gap:10px;align-items:center}
.avatar{width:44px;height:44px;border-radius:50%;object-fit:cover}

.badge{font-size:11px;padding:3px 7px;border-radius:6px;font-weight:700}
.badge.user{background:#eee;color:#444}
.badge.official{background:#e9f1ff;color:#2563eb}
.badge.admin{background:#ffecec;color:#d60000}
.check{color:#1d9bf0;font-size:13px;margin-left:4px}

.title-name{font-size:20px;font-weight:900;letter-spacing:3px}
.meta{font-size:12px;color:#777;display:flex;gap:6px;align-items:center}
.content{margin-top:10px;font-size:15px;line-height:1.6}

.action-row{display:flex;gap:10px;font-size:13px;margin-top:8px;color:#666}
.action-row span{cursor:pointer}

.pinned{background:#fff3cd;color:#9a6700;font-size:11px;padding:4px 8px;border-radius:10px;margin-left:auto}

.comment-box{margin-top:12px;border-top:1px solid #eee;padding-top:10px}
.comment{font-size:13px;margin-top:6px}
.reply{margin-left:18px;color:#444}

input,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd}

@media(max-width:600px){
 .title-name{font-size:17px}
 .avatar{width:38px;height:38px}
}
</style>
</head>
<body>
<header>
 <div class="logo">CIRCLE</div>
 <div>
  <button class="btn" onclick="openProfile()">í”„ë¡œí•„</button>
  <button class="btn primary" onclick="login()">ARRIVE</button>
 </div>
</header>

<div class="container">

<div id="profileBox" class="card" style="display:none">
 <h3>í”„ë¡œí•„ ì„¤ì •</h3>
 <input id="pName" placeholder="ì´ë¦„">
 <input id="pBadge" placeholder="user / official / admin">
 <input id="pAvatar" type="file" accept="image/*">
 <button class="btn primary" onclick="saveProfile()">ì €ì¥</button>
</div>

<div class="card">
 <div class="flex">
  <img id="myAvatar" class="avatar">
  <strong id="myName">Guest</strong>
  <span id="myBadge" class="badge user">USER</span>
 </div>
 <textarea id="postText" rows="3" placeholder="ë¬´ìŠ¨ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ê³  ì‹¶ì–´?"></textarea>
 <input id="postImage" type="file" accept="image/*">
 <div style="display:flex;justify-content:space-between;margin-top:6px">
  <label><input type="checkbox" id="pinCheck"> ê³µì§€(ê´€ë¦¬ì)</label>
  <button class="btn primary" onclick="addPost()">ê²Œì‹œ</button>
 </div>
</div>

<div style="display:flex;gap:8px;margin-bottom:10px">
 <select onchange="filterPosts(this.value)">
  <option value="all">ì „ì²´</option>
  <option value="notice">ê³µì§€</option>
  <option value="official">ê³µì‹</option>
 </select>
</div>

<div id="postList"></div>
</div>

<script>
let user = JSON.parse(localStorage.getItem('circleUser'))||null;
let posts = JSON.parse(localStorage.getItem('circlePosts'))||[];
let filter='all';

function login(){
 const name=prompt('ì´ë¦„');
 if(!name)return;
 user={name,badge:'user',avatar:''};
 localStorage.setItem('circleUser',JSON.stringify(user));
 loadUser();
}

function openProfile(){
 profileBox.style.display=profileBox.style.display==='none'?'block':'none';
}

function saveProfile(){
 if(!user)return;
 const file=pAvatar.files[0];
 const name=pName.value||user.name;
 const badge=pBadge.value||user.badge;
 if(file){
  const r=new FileReader();
  r.onload=()=>{
   user={name,badge,avatar:r.result};
   localStorage.setItem('circleUser',JSON.stringify(user));
   loadUser();
  }
  r.readAsDataURL(file);
 }else{
  user={name,badge,avatar:user.avatar};
  localStorage.setItem('circleUser',JSON.stringify(user));
  loadUser();
 }
}

function loadUser(){
 if(!user)return;
 myName.innerText=user.name;
 myAvatar.src=user.avatar||'https://i.imgur.com/4M34hi2.png';
 myBadge.innerText=user.badge.toUpperCase();
 myBadge.className='badge '+user.badge;
}

function addPost(){
 if(!user){alert('ë¡œê·¸ì¸');return;}
 const text=postText.value.trim();
 if(!text)return;
 const pin=pinCheck.checked && user.badge==='admin';
 const file=postImage.files[0];
 if(file){
  const r=new FileReader();
  r.onload=()=>savePost(text,r.result,pin);
  r.readAsDataURL(file);
 }else savePost(text,'',pin);
}

function savePost(text,img,pin){
 posts.unshift({id:Date.now(),author:user,text,img,pinned:pin,time:new Date().toLocaleString(),likes:0,views:0,comments:[],reports:0});
 sync();render();
 postText.value='';postImage.value='';pinCheck.checked=false;
}

function filterPosts(v){filter=v;render();}

function likePost(id){const p=posts.find(x=>x.id===id);p.likes++;sync();render();}
function viewPost(id){const p=posts.find(x=>x.id===id);p.views++;sync();}
function reportPost(id){if(confirm('ì‹ ê³ ?')){const p=posts.find(x=>x.id===id);p.reports++;sync();alert('ì ‘ìˆ˜ ì™„ë£Œ');}}

function addComment(id){const t=prompt('ëŒ“ê¸€');if(!t)return;const p=posts.find(x=>x.id===id);p.comments.push({text:t,reply:[]});sync();render();}
function replyComment(pid,i){const t=prompt('ë‹µê¸€');if(!t)return;const p=posts.find(x=>x.id===pid);p.comments[i].reply.push(t);sync();render();}

function sync(){localStorage.setItem('circlePosts',JSON.stringify(posts));}

function render(){
 postList.innerHTML='';
 let list=[...posts].sort((a,b)=>b.pinned-a.pinned);
 if(filter==='notice')list=list.filter(p=>p.pinned);
 if(filter==='official')list=list.filter(p=>p.author.badge==='official');

 list.forEach(p=>{
  const el=document.createElement('div');
  el.className='card';
  viewPost(p.id);

  el.innerHTML=`
  <div class="flex">
   <img class="avatar" src="${p.author.avatar||'https://i.imgur.com/4M34hi2.png'}">
   <div>
    <div class="title-name">${p.author.name}${p.author.badge==='official'?'<span class=check>âœ”</span>':''}</div>
    <div class="meta"><span class="badge ${p.author.badge}">${p.author.badge}</span>${p.time}</div>
   </div>
   ${p.pinned?'<span class=pinned>ê³µì§€</span>':''}
  </div>
  <div class="content">${p.text}</div>
  ${p.img?`<img src="${p.img}" style="width:100%;border-radius:12px;margin-top:8px">`:''}
  <div class="action-row">
   <span onclick="likePost(${p.id})">â¤ï¸ ${p.likes}</span>
   <span>ğŸ‘ ${p.views}</span>
   <span onclick="addComment(${p.id})">ğŸ’¬ ${p.comments.length}</span>
   <span onclick="reportPost(${p.id})">ğŸš¨</span>
  </div>
  <div class="comment-box">
   ${p.comments.map((c,i)=>`<div class=comment>${c.text}<span onclick=replyComment(${p.id},${i}) style=color:blue;cursor:pointer> ë‹µê¸€</span>${c.reply.map(r=>`<div class='comment reply'>${r}</div>`).join('')}</div>`).join('')}
  </div>`;

  postList.appendChild(el);
 });
}

loadUser();render();
</script>
</body>
</html>

