<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>CIRCLE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont}
body{margin:0;background:#fff}

.hidden{display:none}

button{border:none;border-radius:10px;padding:10px;cursor:pointer}

input,textarea{
width:100%;
padding:10px;
border-radius:10px;
border:1px solid #ddd;
outline:none;
}

/* LOGIN */

#login{
height:100vh;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
gap:15px;
}

#login input{width:220px;text-align:center}

/* NAV */

nav{
position:fixed;
bottom:0;
width:100%;
background:#fff;
display:flex;
justify-content:space-around;
padding:10px;
border-top:1px solid #eee;
}

nav button{background:none;font-size:18px}

/* HOME */

#home{padding:15px;padding-bottom:80px}

.card{
background:#ffd6e8;
border-radius:20px;
padding:15px;
margin-bottom:15px;
animation:pop .4s ease;
}

@keyframes pop{
from{transform:scale(.9);opacity:0}
to{transform:scale(1);opacity:1}
}

/* STORY */

#stories{display:flex;gap:10px;overflow-x:auto}

.story{
width:70px;height:70px;
border-radius:50%;
background:#ff7ab6;
display:flex;
align-items:center;
justify-content:center;
color:#fff;
font-weight:bold;
}

/* COMMUNITY */

.post{
background:#ffd6e8;
padding:15px;
border-radius:20px;
margin-bottom:15px;
}

.post img{width:100%;border-radius:15px;margin-top:10px}

.actions button{margin-right:5px}

/* CHAT */

#chatList div{
padding:12px;
border-bottom:1px solid #eee;
cursor:pointer;
}

.chatBox{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#fff;
display:flex;
flex-direction:column;
}

.messages{
flex:1;
padding:10px;
overflow-y:auto;
}

.msg{
margin-bottom:10px;
}

.bubble{
display:inline-block;
padding:10px;
border-radius:15px;
background:#ffd6e8;
}

.time{font-size:11px;color:#666}

/* LIVE */

#live video{width:100%}

.heart{
position:absolute;
bottom:80px;
right:30px;
font-size:24px;
animation:float 2s linear forwards;
}

@keyframes float{
from{transform:translateY(0);opacity:1}
to{transform:translateY(-150px);opacity:0}
}

</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
<h2>CIRCLE</h2>
<input id="nameInput" placeholder="ÎãâÎÑ§ÏûÑ">
<button onclick="login()">ENTER</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<!-- HOME -->
<div id="home">
<div id="stories"></div>
<div id="feed"></div>
</div>

<!-- COMMUNITY -->
<div id="community" class="hidden">
<button onclick="openWrite()">Í∏ÄÏì∞Í∏∞</button>
<div id="posts"></div>
</div>

<!-- CHAT -->
<div id="chat" class="hidden">
<button onclick="newChat()">+ Ï±ÑÌåÖ Ï∂îÍ∞Ä</button>
<div id="chatList"></div>
</div>

<!-- LIVE -->
<div id="live" class="hidden">
<video id="camera" autoplay></video>
<button onclick="heart()">‚ù§Ô∏è</button>
</div>

<nav>
<button onclick="show('home')">üè†</button>
<button onclick="show('community')">üìù</button>
<button onclick="show('chat')">üí¨</button>
<button onclick="show('live')">üî¥</button>
</nav>

</div>

<script>

let user = localStorage.getItem("circleUser");
if(user){
document.getElementById("login").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");
}

document.getElementById("nameInput").addEventListener("keydown",e=>{
if(e.key==="Enter") login();
});

function login(){
let name = nameInput.value.trim();
if(!name)return alert("ÎãâÎÑ§ÏûÑ ÏûÖÎ†•");
localStorage.setItem("circleUser",name);
location.reload();
}

/* NAV */

function show(id){
["home","community","chat","live"].forEach(x=>{
document.getElementById(x).classList.add("hidden");
});
document.getElementById(id).classList.remove("hidden");
}

/* STORY */

let stories = JSON.parse(localStorage.getItem("stories")||"[]");

function renderStory(){
storiesDiv.innerHTML="";
stories.forEach(s=>{
let d=document.createElement("div");
d.className="story";
d.innerText=s.name[0];
storiesDiv.appendChild(d);
});
}

storiesDiv=document.getElementById("stories");

storiesDiv.onclick=()=>{
let file=document.createElement("input");
file.type="file";
file.onchange=e=>{
let reader=new FileReader();
reader.onload=()=>{
stories.push({name:user,img:reader.result});
localStorage.setItem("stories",JSON.stringify(stories));
renderStory();
};
reader.readAsDataURL(e.target.files[0]);
};
file.click();
}

renderStory();

/* COMMUNITY */

let posts=JSON.parse(localStorage.getItem("posts")||"[]");

function openWrite(){
let txt=prompt("ÎÇ¥Ïö© ÏûÖÎ†•");
if(!txt)return;
posts.unshift({user,txt,likes:0});
savePost();
}

function savePost(){
localStorage.setItem("posts",JSON.stringify(posts));
renderPost();
}

function renderPost(){
postsDiv.innerHTML="";
posts.forEach((p,i)=>{
let d=document.createElement("div");
d.className="post";
d.innerHTML=`
<b>${p.user}</b>
<p>${p.txt.replace(/\n/g,"<br>")}</p>
<div class="actions">
<button onclick="like(${i})">‚ù§Ô∏è ${p.likes}</button>
<button onclick="editPost(${i})">‚úèÔ∏è</button>
<button onclick="delPost(${i})">üóë</button>
</div>
<textarea id="c${i}" placeholder="ÎåìÍ∏Ä"></textarea>
<button onclick="comment(${i})">Î≥¥ÎÇ¥Í∏∞</button>
`;
postsDiv.appendChild(d);
});
}

postsDiv=document.getElementById("posts");

function like(i){posts[i].likes++;savePost()}
function delPost(i){posts.splice(i,1);savePost()}
function editPost(i){
let t=prompt("ÏàòÏ†ï",posts[i].txt);
if(t){posts[i].txt=t;savePost();}
}
function comment(i){
alert("ÎåìÍ∏Ä Ï†ÄÏû• ÏôÑÎ£å(Î°úÏª¨)");
}

renderPost();

/* CHAT */

let chats=JSON.parse(localStorage.getItem("chats")||"[]");

function newChat(){
let name=prompt("ÏÉÅÎåÄ Ïù¥Î¶Ñ");
if(!name)return;
chats.push({name,msgs:[]});
saveChat();
}

function saveChat(){
localStorage.setItem("chats",JSON.stringify(chats));
renderChatList();
}

function renderChatList(){
chatList.innerHTML="";
chats.forEach((c,i)=>{
let d=document.createElement("div");
d.innerText=c.name;
d.onclick=()=>openChat(i);
chatList.appendChild(d);
});
}

function openChat(i){
let box=document.createElement("div");
box.className="chatBox";
box.innerHTML=`
<div class="messages" id="m"></div>
<input id="send">
`;
document.body.appendChild(box);

let input=box.querySelector("#send");

input.addEventListener("keydown",e=>{
if(e.key==="Enter"){
let t=input.value;
if(!t)return;
chats[i].msgs.push({u:user,t,time:new Date().toLocaleTimeString()});
saveChat();
renderMsg();
input.value="";
}
});

function renderMsg(){
let m=box.querySelector("#m");
m.innerHTML="";
chats[i].msgs.forEach(x=>{
let d=document.createElement("div");
d.className="msg";
d.innerHTML=`<b>${x.u}</b><div class="bubble">${x.t}</div><div class="time">${x.time}</div>`;
m.appendChild(d);
});
}
renderMsg();
}

renderChatList();

/* LIVE */

navigator.mediaDevices.getUserMedia({video:true})
.then(s=>camera.srcObject=s);

function heart(){
let h=document.createElement("div");
h.className="heart";
h.innerText="‚ù§Ô∏è";
document.body.appendChild(h);
setTimeout(()=>h.remove(),2000);
}

</script>

</body>
</html>
